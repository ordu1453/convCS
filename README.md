# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞, –µ–≥–æ –º–æ–¥—É–ª–µ–π –∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞ —Ä–∞–±–æ—Ç—ã.

---

## üìÅ –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### `config.h`

* –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞: —á–∞—Å—Ç–æ—Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è, –ª–∏–º–∏—Ç—ã –ø–æ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—é –∏ —Ç–æ–∫—É, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è ADC, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã PWM.
* –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å–∏—Å—Ç–µ–º—ã (`SystemState_t`) –∏ –∫–æ–¥—ã –æ—à–∏–±–æ–∫.

### `types.h`

* –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä `SensorValues_t` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Ç–æ–∫–æ–≤ –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–π.

---

## üìÅ –°–±–æ—Ä –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤

### `sensor.h` / `sensor.c`

* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ADC, –∑–∞–ø—É—Å–∫ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å DMA.
* –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—ã—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ADC –≤ —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–æ–∫–∏ (–º–ê) –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è (–º–í).
* –§—É–Ω–∫—Ü–∏–∏:

  * `sensorInit()` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä –∏ ADC.
  * `sensorStartADC()` ‚Äî –∑–∞–ø—É—Å–∫ DMA ADC.
  * `sensorPoll()` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.
  * `sensorGetValues()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–∞—Ç—á–∏–∫–æ–≤.

---

## üìÅ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### `diag.h` / `diag.c`

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –¥–∞—Ç—á–∏–∫–æ–≤ –Ω–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø—Ä–µ–¥–µ–ª–æ–≤.
* –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏—Ç–æ–≤–æ–π –º–∞—Å–∫–∏ –æ—à–∏–±–æ–∫:

  * –ü–µ—Ä–µ–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –Ω–µ–¥–æ–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç–æ–∫–∞, –æ—à–∏–±–∫–∏ IGBT-–¥—Ä–∞–π–≤–µ—Ä–∞.
* –§—É–Ω–∫—Ü–∏–∏:

  * `diagInit()` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
  * `diagCheck()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫.

---

## üìÅ –ö–æ–Ω—Ç—Ä–æ–ª—å –∏ —Ä–µ–≥—É–ª—è—Ü–∏—è

### `pid.h` / `pid.c`

* –ü–ò-—Ä–µ–≥—É–ª—è—Ç–æ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–≤–∞–∂–Ω–æ—Å—Ç—å—é PWM.
* –§—É–Ω–∫—Ü–∏–∏:

  * `pidInit()` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
  * `pidUpdate()` ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—à–∏–±–∫–∏ –∏ dt.
  * `pidReset()` ‚Äî —Å–±—Ä–æ—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä–∞ –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–∂–∏–º–∞.

### `pwm.h` / `pwm.c`

* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏ —Ç–∞–π–º–µ—Ä–∞ TIM1 –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –®–ò–ú.
* –§—É–Ω–∫—Ü–∏–∏:

  * `pwmInit()` ‚Äî –∑–∞–ø—É—Å–∫ –∫–∞–Ω–∞–ª–æ–≤ PWM.
  * `pwmSetDuty()` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫–≤–∞–∂–Ω–æ—Å—Ç–∏.
  * `pwmGetArr()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è ARR.
  * `pwmDisable()` / `pwmEnable()` ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –®–ò–ú.

### `pwmHandler.h` / `pwmHandler.c`

* –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –®–ò–ú –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
* –§—É–Ω–∫—Ü–∏–∏:

  * `pwmHandlerInit()` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è.
  * `pwmHandlerProcess()` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –®–ò–ú.

---

## üìÅ –ü—Ä–µ–¥–∑–∞—Ä—è–¥ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞

### `precharge.h` / `precharge.c`

* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–∑–∞—Ä—è–¥–∫–∏ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ —Ä–µ–ª–µ.
* –§—É–Ω–∫—Ü–∏–∏:

  * `prechargeInit()` ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ GPIO.
  * `prechargeStart()` ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–ª–µ –Ω–∞ 5 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

---

## üìÅ –†–∞–±–æ—Ç–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—è

### `converter.h` / `converter.c`

* –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—è: –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞, –≤—ã–∑–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –ü–ò-—Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –®–ò–ú.
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ä–µ–∂–∏–º—ã: `CHARGE`, `DISCHARGE`, `IDLE`, `PRECHARGE`.
* –§—É–Ω–∫—Ü–∏–∏:

  * `converterInit()` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤.
  * `converterProcess()` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –≤—ã–∑–æ–≤ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–ª–æ–∫–æ–≤.

---

## üìÅ FDCAN –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è

### `can.h` / `can.c`

* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FDCAN1 –∏ FDCAN2.
* –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ —Å —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ–º —à–∏–Ω –∫–∞–∂–¥—ã–µ 250 –º—Å.
* –ü—Ä–∏—ë–º —Å–æ–æ–±—â–µ–Ω–∏–π —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ –±–ª–æ–∫–∞: —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∏ —Ü–µ–ª–µ–≤–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.
* –§—É–Ω–∫—Ü–∏–∏:

  * `canInit()` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FDCAN.
  * `canProcessPeriodic()` ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏.
  * `canPublishTelemetry()` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏.
  * `canReceiveHandler()` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
  * `HAL_FDCAN_RxFifo0Callback()` ‚Äî –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–∏—ë–º–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

---

## üìÅ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª

### `main.c`

* –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø—Ä–æ–µ–∫—Ç–∞ –∏ SysTick –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π.
* –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:

  * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–∏—Ñ–µ—Ä–∏–π–Ω—ã—Ö –±–ª–æ–∫–æ–≤ (ADC, TIM, FDCAN, GPIO).
  * –ó–∞–ø—É—Å–∫ ADC DMA.
  * –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –≤—Ä–µ–º–µ–Ω–∏ dt –¥–ª—è –≤—ã–∑–æ–≤–∞ `converterProcess()`.
  * –û–±—Ä–∞–±–æ—Ç–∫–∞ CAN —á–µ—Ä–µ–∑ `canProcessPeriodic()`.

---

## üí° –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –ø–µ—Ä–∏—Ñ–µ—Ä–∏–π–Ω—ã–µ –º–æ–¥—É–ª–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
2. ADC –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ DMA –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤.
3. FDCAN –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è, –≥–æ—Ç–æ–≤—è—Ç—Å—è –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –∏ –ø—Ä–∏—ë–º—É —Å–æ–æ–±—â–µ–Ω–∏–π.
4. –í –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ –∫–∞–∂–¥—ã–µ `CONTROL_DT_MS`:

   * –°—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–æ–≤ (`sensorPoll()`).
   * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (`diagCheck()`).
   * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –±–ª–æ–∫ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—è (`converterProcess()`), –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –ü–ò-—Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–º, PWM –∏ –ø—Ä–µ–¥–∑–∞—Ä—è–¥–æ–º.
   * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –ø–æ FDCAN (`canPublishTelemetry()`).
5. –í—Ö–æ–¥—è—â–∏–µ FDCAN-—Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ–º –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∏ —Ü–µ–ª–µ–≤–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.
6. PWM –≤–∫–ª—é—á–∞–µ—Ç—Å—è/–≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –Ω–∞–ª–∏—á–∏—è –æ—à–∏–±–æ–∫.

---

